Урок 10.
Цель занятия - писать скрипты на языка bash.
Краткое содержание :
	профайл;
	переменные;
	логические операции;
	массивы;
	условия;
	циклы;
	функции.
Результат - написать скрипт.
Домашнее задание - Написать скрипт для CRON, который раз в час будет формировать письмо и отправлять на заданную почту.
Необходимая информация в письме:
1. Список IP адресов (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта;
2. Список запрашиваемых URL (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта;
3. Ошибки веб-сервера/приложения c момента последнего запуска;
4. Список всех кодов HTTP ответа с указанием их кол-ва с момента последнего запуска скрипта.
5. Скрипт должен предотвращать одновременный запуск нескольких копий, до его завершения.
6. В письме должен быть прописан обрабатываемый временной диапазон.
7. В чат ДЗ отправьте ссылку на ваш git-репозиторий . Обычно мы проверяем ДЗ в течение 48 часов.
8. Если возникнут вопросы, обращайтесь к студентам, преподавателям и наставникам в канал группы в Telegram. Удачи при выполнении!

Результат выполнения:
1. Вроде ничего сложного. Скрипты мы начали писать ещё на первом занятии. Начинаем работать с конца ДЗ. Нужно из коммандной строки отправить письмо.
	В начале двухтысячных годов я через telnet и бесплатный почтовый сервер microsoft.com это легко делал.
	Выполняем - 
	mail
	/home/garik/DZ/DZ4>mail
	/bin/sh: 1: mail: not found	
2. Устанавливаем почту -
	/home/garik/DZ/DZ4>sudo apt install -y mailutils
	Проверяем -
	/home/garik/DZ/DZ4>systemctl status postfix
	● postfix.service - Postfix Mail Transport Agent
     Loaded: loaded (/lib/systemd/system/postfix.service; enabled; vendor preset: enabled)
     Active: active (exited) since Tue 2023-06-20 08:25:30 +07; 54s ago
       Docs: man:postfix(1)
    Process: 3342 ExecStart=/bin/true (code=exited, status=0/SUCCESS)
    Main PID: 3342 (code=exited, status=0/SUCCESS)
        CPU: 1ms
	июн 20 08:25:30 garik-VirtualBox systemd[1]: Starting Postfix Mail Transport Agent...
	июн 20 08:25:30 garik-VirtualBox systemd[1]: Finished Postfix Mail Transport Agent.
3. Пытаемся отправить почту не из вложенной виртуалки - 
	echo 'Тестовое сообщение...' | mail -s 'Тема письма' 305-679@mail.ru
	Ноль реакции и письмо никуда не приходит.
	Методом тяжелого ГуглЕния в Яндексе на просторах Интернета, чтения лога майла в /var/log/mail.log, применив Третий Закон Ньютона,
	т.к. первые два не сработали, понимаю, что вероятно дело в Русском языке, или Linux не парсит почтовый ящик с числовым именем.
4. Набираем - mail :
	/home/garik/DZ>mail
	"/var/mail/garik": 1 message 1 new
	>N   1 Mail Delivery Syst Вт июн 20 0  74/2440  Undelivered Mail Returned to Sender
	?
	Письмо никуда не уходит. Пишем "d" и удаляем его.
3. echo 'Тестовое сообщение.' | mail -s 'from Linux Mint 21.1 Vera' tii@r-19.ru -
	Прошло отлично и в Аутглюке, и в Сандерберде (Буревестник). Но, в Аутлуке - кракозяблы.
4. Пишем скрипты -
	1. Первое задание - 1.get_xip.sh
	2. Второе задание - 2.get_url.sh
	3. Третье и четвертое задания - 3-4.get_err.sh (ставим sleep на 60 секунд)
	4. Пятое задание - 5.scriptAll.sh. Результат - ([Ссылка на отправляемый файл](test.log))
5. Чтобы проверить на мультизапуск, вручную запускем в фоне -
	./5.scriptAll.sh &
	Проверям повторность - ./5.scriptAll.sh
	Получаем -
	/home/garik/DZ/DZ9-4>./5.scriptAll.sh &
	/home/garik/DZ/DZ9-4>./5.scriptAll.sh
	Код возврата flock -  1
	А!!! Блин, ниче не работает... Ждем через CRON следующего запуска.
	/home/garik/DZ/DZ9-4>./5.scriptAll.sh
	Код возврата flock -  1
	А!!! Блин, ниче не работает... Ждем через CRON следующего запуска.
	/home/garik/DZ/DZ9-4>./5.scriptAll.sh
	Код возврата flock -  1
	А!!! Блин, ниче не работает... Ждем через CRON следующего запуска.
	Через минуту работы скрипта получаем результат запуска второго раза -
	Код возврата flock -  0
	Т.к. файл не был заблокирован, то скрипт должен сработать !!!
6. Теперь запускаем CRON-задачу -
	crontab -e
	Вставляем - 
	* * * * * /home/garik/DZ/DZ9-4/5.scriptAll.sh 
	Не забываем в конце файла поставить еще одну пустую строку.
	Меняем в crontab'е на -
	*/4 * * * * /home/garik/DZ/DZ9-4/5.scriptAll.sh
	Работает каждые четыре минуты!
	Для удаления всех заданий -
	crontab -r
7. Запускаем вложенную виртулку CetOS/7
	Vagrant up
	(Ждем минут пять. Зачем три штуки для домашнего задания запускать, мне не понятно до сих пор???)	
8. Vagrant ssh bash
9. Чтобы все по нормальному сработало устанавливаем пакет MC -
	sudo yum install -y mc
	Не проходит. Включаем VPN, пакет устанавливается, но, в наш Хакасский домен (r-19.ru) почта не придет никогда, т.к. VPN включЕн!!!
	Устанавливаем почту -
	sudo jum install -y mailx
	После установки отключаем VPN. Пока делал "домашку" по телевизору показали "Однажды в России" с этим сюжетом ("Однажды в России. 10 сезон. 07 выпуск")). Вот в точку попали.
	Проверяем успешность работы.
11. Копируем из /vagrant все скрипты в /home/vagrant, т.к. ./5.scriptAll.sh в CRON'е запускается из домашнего каталога.
	Исправляем в файле 5.scriptAll.sh тему письма на "Message Very Subject from CentOS/7".
11. Для проверки работы проверяем все те грабли на которые мы наступили в Linux Mint 21.1 Vera - одинаково.
12. Настраиваем CRON. Здесь пригодился пакет MC -
	export EDITOR=/usr/bin/mcedit
	crontab -e
	Вставляем (один раз в шесть минут для полной уверенности, что эта почта от разных машин) - 
	*/6 * * * * /home/garik/DZ/DZ9-4/5.scriptAll.sh 
13. Четко видим, что из Linux Mint 21.1 Vera приходит чере 6 минут, а, из мертвого CentOS'f через 4. ([Ссылка на Outlook.jpg](Outlook.jpg))
14. Все!
